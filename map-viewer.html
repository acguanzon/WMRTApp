<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Waste Management Route Map</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
        }

        .info-panel {
            position: absolute;
            top: 10px;
            right: 10px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            z-index: 1000;
            font-size: 13px;
        }

        .info-panel h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #2c5f2d;
        }

        .info-panel .stat {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
        }

        .info-panel .stat span:first-child {
            font-weight: 600;
        }

        .legend {
            position: absolute;
            bottom: 30px;
            right: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            font-size: 12px;
        }

        .legend-item {
            margin: 5px 0;
            display: flex;
            align-items: center;
        }

        .legend-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            display: inline-block;
        }

        .status-open {
            background-color: #4CAF50;
        }

        .status-busy {
            background-color: #FF9800;
        }

        .status-closed {
            background-color: #f44336;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <div class="info-panel" id="info-panel">
        <h3>üìç Route Information</h3>
        <div class="stat">
            <span>Total Distance:</span>
            <span id="total-distance">-</span>
        </div>
        <div class="stat">
            <span>Centers Visited:</span>
            <span id="centers-count">-</span>
        </div>
        <div class="stat">
            <span>Estimated Time:</span>
            <span id="est-time">-</span>
        </div>
    </div>

    <div class="legend">
        <div class="legend-item">
            <span class="legend-icon status-open"></span>
            <span>Open</span>
        </div>
        <div class="legend-item">
            <span class="legend-icon status-busy"></span>
            <span>Busy</span>
        </div>
        <div class="legend-item">
            <span class="legend-icon status-closed"></span>
            <span>Closed</span>
        </div>
    </div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        var map = L.map('map').setView([10.6762, 122.9501], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors',
            maxZoom: 19,
            minZoom: 11
        }).addTo(map);

        var markers = {};
        var routePolyline = null;
        var depotMarker = null;

        function getMarkerColor(status) {
            switch (status.toLowerCase()) {
                case 'open': return '#4CAF50';
                case 'busy': return '#FF9800';
                case 'closed': return '#f44336';
                default: return '#2196F3';
            }
        }

        function addCenter(id, lat, lng, name, status, guidelines) {
            console.log('addCenter called:', id, lat, lng, name, status);
            var color = getMarkerColor(status);
            var icon = L.divIcon({
                className: 'custom-div-icon',
                html: '<div style="background-color: ' + color + '; width: 30px; height: 30px; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"></div>',
                iconSize: [30, 30],
                iconAnchor: [15, 15]
            });

            var marker = L.marker([lat, lng], { icon: icon }).addTo(map);
            var popupContent = '<div style="min-width: 200px;">' +
                '<h4 style="margin: 0 0 8px 0; color: ' + color + ';">' + name + '</h4>' +
                '<p style="margin: 5px 0;"><strong>Status:</strong> <span style="color: ' + color + ';">' + status + '</span></p>' +
                '<p style="margin: 5px 0; font-size: 12px;">' + guidelines + '</p>' +
                '<p style="margin: 5px 0; font-size: 11px; color: #666;"><strong>ID:</strong> ' + id + '</p>' +
                '</div>';

            marker.bindPopup(popupContent);
            markers[id] = marker;
            console.log('Marker added successfully');
            return marker;
        }

        function addSubmissionMarker(id, lat, lng, name, status, guidelines) {
            console.log('addSubmissionMarker called:', id, lat, lng, name, status);
            var color = getMarkerColor(status);
            // Distinct Recycling Icon Style
            var icon = L.divIcon({
                className: 'custom-div-icon',
                html: '<div style="background-color: ' + color + '; width: 36px; height: 36px; border-radius: 50%; border: 3px solid white; box-shadow: 0 3px 6px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; font-size: 20px;">‚ôªÔ∏è</div>',
                iconSize: [36, 36],
                iconAnchor: [18, 18]
            });

            var marker = L.marker([lat, lng], { icon: icon }).addTo(map);
            var popupContent = '<div style="min-width: 200px;">' +
                '<h4 style="margin: 0 0 8px 0; color: ' + color + ';">‚ôªÔ∏è ' + name + '</h4>' +
                '<p style="margin: 5px 0;"><strong>Status:</strong> <span style="color: ' + color + ';">' + status + '</span></p>' +
                '<p style="margin: 5px 0; font-size: 12px;">' + guidelines + '</p>' +
                '<p style="margin: 5px 0; font-size: 11px; color: #666;"><strong>ID:</strong> ' + id + '</p>' +
                '<div style="margin-top: 8px; padding: 5px; background: #e8f5e9; border-radius: 4px; text-align: center; font-size: 11px; color: #2e7d32;"><strong>Drop-off Point</strong></div>' +
                '</div>';

            marker.bindPopup(popupContent);
            markers[id] = marker;
            console.log('Submission marker added successfully');
            return marker;
        }

        function addDepot(lat, lng) {
            console.log('addDepot called:', lat, lng);
            if (depotMarker) map.removeLayer(depotMarker);
            var icon = L.divIcon({
                className: 'custom-div-icon',
                html: '<div style="background-color: #1976D2; width: 35px; height: 35px; border-radius: 50%; border: 4px solid white; box-shadow: 0 3px 8px rgba(0,0,0,0.4); display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 18px;">üè†</div>',
                iconSize: [35, 35],
                iconAnchor: [17.5, 17.5]
            });
            depotMarker = L.marker([lat, lng], { icon: icon }).addTo(map);
            depotMarker.bindPopup('<h4 style="margin: 0;">Depot / Starting Point</h4>');
            console.log('Depot added successfully');
        }

        function drawRoute(routePoints, color) {
            if (routePolyline) map.removeLayer(routePolyline);
            if (!routePoints || routePoints.length === 0) return;
            color = color || '#2196F3';
            routePolyline = L.polyline(routePoints, { color: color, weight: 4, opacity: 0.7, smoothFactor: 1 }).addTo(map);
            map.fitBounds(routePolyline.getBounds(), { padding: [50, 50] });
        }

        function clearRoute() {
            if (routePolyline) { map.removeLayer(routePolyline); routePolyline = null; }
        }

        function clearAllMarkers() {
            console.log('clearAllMarkers called');
            for (var id in markers) map.removeLayer(markers[id]);
            markers = {};
            if (depotMarker) { map.removeLayer(depotMarker); depotMarker = null; }
            console.log('All markers cleared');
        }

        function updateInfo(distance, centersCount, estimatedTime) {
            document.getElementById('total-distance').textContent = distance || '-';
            document.getElementById('centers-count').textContent = centersCount || '-';
            document.getElementById('est-time').textContent = estimatedTime || '-';
        }

        function highlightCenter(centerId) {
            console.log('highlightCenter called for:', centerId);
            if (markers[centerId]) {
                markers[centerId].openPopup();
                map.setView(markers[centerId].getLatLng(), 15);
                console.log('Center highlighted');
            } else {
                console.log('Center not found:', centerId);
            }
        }

        window.addCenter = addCenter;
        window.addSubmissionMarker = addSubmissionMarker;
        window.addDepot = addDepot;
        window.drawRoute = drawRoute;
        window.clearRoute = clearRoute;
        window.clearAllMarkers = clearAllMarkers;
        window.updateInfo = updateInfo;
        window.highlightCenter = highlightCenter;

        console.log('Map initialized and ready - Java can now add markers');
    </script>
</body>

</html>